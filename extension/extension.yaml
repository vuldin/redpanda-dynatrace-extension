name: custom:redpanda.enhanced
version: 1.0.13
minDynatraceVersion: '1.310'
author:
  name: Custom Enhanced Redpanda Extension
topology:
  types:
    - name: redpanda:cluster
      displayName: Redpanda Cluster
      enabled: true
      rules:
        - idPattern: redpanda_cluster_{redpanda_cluster}
          instanceNamePattern: "{redpanda_cluster}"
          sources:
            - sourceType: Metrics
              condition: $prefix(redpanda.cluster)
          attributes:
            - pattern: '{redpanda_cluster}'
              key: cluster_name
              displayName: Cluster Name
    - name: redpanda:namespace
      displayName: Redpanda Namespace
      enabled: true
      rules:
        - idPattern: redpanda_namespace_{redpanda_cluster}_{redpanda_namespace}
          instanceNamePattern: "{redpanda_namespace}"
          sources:
            - sourceType: Metrics
              condition: $prefix(redpanda.kafka)
          attributes:
            - pattern: '{redpanda_cluster}'
              key: cluster
              displayName: Cluster
            - pattern: '{redpanda_namespace}'
              key: namespace
              displayName: Namespace
    - name: redpanda:topic
      displayName: Redpanda Topic
      enabled: true
      rules:
        - idPattern: redpanda_topic_{redpanda_cluster}_{redpanda_namespace}_{redpanda_topic}
          instanceNamePattern: "{redpanda_topic}"
          sources:
            - sourceType: Metrics
              condition: $prefix(redpanda.kafka)
          attributes:
            - pattern: '{redpanda_cluster}'
              key: cluster
              displayName: Cluster
            - pattern: '{redpanda_namespace}'
              key: namespace
              displayName: Namespace
            - pattern: '{redpanda_topic}'
              key: topic
              displayName: Topic Name
            - pattern: '{redpanda_kafka_replicas}'
              key: replication_factor
              displayName: Replication Factor
    - name: redpanda:partition
      displayName: Redpanda Partition
      enabled: true
      rules:
        - idPattern: redpanda_partition_{redpanda_cluster}_{redpanda_namespace}_{redpanda_topic}_{redpanda_partition}
          instanceNamePattern: "{redpanda_topic} - Partition {redpanda_partition}"
          sources:
            - sourceType: Metrics
              condition: $prefix(redpanda.kafka)
          attributes:
            - pattern: '{redpanda_cluster}'
              key: cluster
              displayName: Cluster
            - pattern: '{redpanda_namespace}'
              key: namespace
              displayName: Namespace
            - pattern: '{redpanda_topic}'
              key: topic
              displayName: Topic Name
            - pattern: '{redpanda_partition}'
              key: partition_id
              displayName: Partition ID
  relationships:
    - fromType: redpanda:namespace
      typeOfRelation: CHILD_OF
      toType: redpanda:cluster
      sources:
        - sourceType: Metrics
          condition: $prefix(redpanda.kafka)
    - fromType: redpanda:topic
      typeOfRelation: CHILD_OF
      toType: redpanda:namespace
      sources:
        - sourceType: Metrics
          condition: $prefix(redpanda.kafka)
    - fromType: redpanda:partition
      typeOfRelation: CHILD_OF
      toType: redpanda:topic
      sources:
        - sourceType: Metrics
          condition: $prefix(redpanda.kafka)
prometheus:
- group: latency_metrics
  interval:
    minutes: 1
  dimensions:
  - key: redpanda_cluster
    value: const:your-redpanda-cluster
  subgroups:
  - subgroup: kafka_request_latency
    dimensions:
    - key: redpanda_request
      value: label:redpanda_request
    - key: redpanda_server
      value: label:redpanda_server
    - key: le
      value: label:le
    metrics:
    - key: redpanda.kafka.request.latency.seconds
      value: metric:redpanda_kafka_request_latency_seconds
      type: histogram
  - subgroup: rpc_request_latency
    dimensions:
    - key: redpanda_server
      value: label:redpanda_server
    - key: le
      value: label:le
    metrics:
    - key: redpanda.rpc.request.latency.seconds
      value: metric:redpanda_rpc_request_latency_seconds
      type: histogram
  - subgroup: rest_proxy_request_latency
    dimensions:
    - key: le
      value: label:le
    metrics:
    - key: redpanda.rest_proxy.request.latency.seconds
      value: metric:redpanda_rest_proxy_request_latency_seconds
      type: histogram
- group: io_performance
  interval:
    minutes: 1
  dimensions:
  - key: redpanda_cluster
    value: const:your-redpanda-cluster
  - key: shard
    value: label:shard
  metrics:
  - key: redpanda.io.queue.read.ops.total
    value: metric:redpanda_io_queue_total_read_ops
    type: count
  - key: redpanda.io.queue.write.ops.total
    value: metric:redpanda_io_queue_total_write_ops
    type: count
- group: partition_health
  interval:
    minutes: 1
  dimensions:
  - key: redpanda_cluster
    value: const:your-redpanda-cluster
  subgroups:
  - subgroup: cluster_level_metrics
    metrics:
    - key: redpanda.cluster.unavailable_partitions
      value: metric:redpanda_cluster_unavailable_partitions
      type: gauge
    - key: redpanda.node.status.rpcs_timed_out
      value: metric:redpanda_node_status_rpcs_timed_out
      type: count
    - key: redpanda.cluster.brokers
      value: metric:redpanda_cluster_brokers
      type: gauge
    - key: redpanda.cluster.partitions
      value: metric:redpanda_cluster_partitions
      type: gauge
    - key: redpanda.cluster.topics
      value: metric:redpanda_cluster_topics
      type: gauge
  - subgroup: topic_level_metrics
    dimensions:
    - key: redpanda_namespace
      value: label:redpanda_namespace
    - key: redpanda_topic
      value: label:redpanda_topic
    metrics:
    - key: redpanda.raft.leadership.changes
      value: metric:redpanda_raft_leadership_changes
      type: count
  - subgroup: partition_level_metrics
    dimensions:
    - key: redpanda_namespace
      value: label:redpanda_namespace
    - key: redpanda_topic
      value: label:redpanda_topic
    - key: redpanda_partition
      value: label:redpanda_partition
    metrics:
    - key: redpanda.kafka.under_replicated_replicas
      value: metric:redpanda_kafka_under_replicated_replicas
      type: gauge
- group: throughput
  interval:
    minutes: 1
  dimensions:
  - key: redpanda_cluster
    value: const:your-redpanda-cluster
  - key: redpanda_server
    value: label:redpanda_server
  metrics:
  - key: redpanda.rpc.received.bytes
    value: metric:redpanda_rpc_received_bytes
    type: count
  - key: redpanda.rpc.sent.bytes
    value: metric:redpanda_rpc_sent_bytes
    type: count
- group: infrastructure
  interval:
    minutes: 1
  dimensions:
  - key: redpanda_cluster
    value: const:your-redpanda-cluster
  subgroups:
  - subgroup: cpu_metrics
    metrics:
    - key: redpanda.cpu.busy.seconds.total
      value: metric:redpanda_cpu_busy_seconds_total
      type: count
    - key: redpanda.uptime.seconds.total
      value: metric:redpanda_application_uptime_seconds_total
      type: gauge
  - subgroup: memory_metrics
    metrics:
    - key: redpanda.memory.available.bytes
      value: metric:redpanda_memory_available_memory
      type: gauge
    - key: redpanda.memory.free.bytes
      value: metric:redpanda_memory_free_memory
      type: gauge
    - key: redpanda.memory.allocated.bytes
      value: metric:redpanda_memory_allocated_memory
      type: gauge
  - subgroup: disk_metrics
    dimensions:
    - key: shard
      value: label:shard
    metrics:
    - key: redpanda.storage.disk.free.bytes
      value: metric:redpanda_storage_disk_free_bytes
      type: gauge
    - key: redpanda.storage.disk.total.bytes
      value: metric:redpanda_storage_disk_total_bytes
      type: gauge
    - key: redpanda.storage.disk.free_space_alert
      value: metric:redpanda_storage_disk_free_space_alert
      type: gauge
  - subgroup: application_metadata
    dimensions:
    - key: redpanda_version
      value: label:redpanda_version
    - key: redpanda_revision
      value: label:redpanda_revision
    metrics:
    - key: redpanda.application.build
      value: metric:redpanda_application_build
      type: gauge
- group: service_errors
  interval:
    minutes: 1
  dimensions:
  - key: redpanda_cluster
    value: const:your-redpanda-cluster
  metrics:
  - key: redpanda.schema_registry.request.errors.total
    value: metric:redpanda_schema_registry_request_errors_total
    type: count
  - key: redpanda.rest_proxy.request.errors.total
    value: metric:redpanda_rest_proxy_request_errors_total
    type: count
- group: consumer_groups
  interval:
    minutes: 1
  dimensions:
  - key: redpanda_cluster
    value: const:your-redpanda-cluster
  - key: redpanda_group
    value: label:redpanda_group
  - key: redpanda_topic
    value: label:redpanda_topic
  - key: redpanda_partition
    value: label:redpanda_partition
  metrics:
  - key: redpanda.kafka.consumer_group.lag.max
    value: metric:redpanda_kafka_consumer_group_lag_max
    type: gauge
  - key: redpanda.kafka.consumer_group.lag.sum
    value: metric:redpanda_kafka_consumer_group_lag_sum
    type: gauge
  - key: redpanda.kafka.consumer_group.committed_offset
    value: metric:redpanda_kafka_consumer_group_committed_offset
    type: gauge
  - key: redpanda.kafka.consumer_group.consumers
    value: metric:redpanda_kafka_consumer_group_consumers
    type: gauge
  - key: redpanda.kafka.consumer_group.topics
    value: metric:redpanda_kafka_consumer_group_topics
    type: gauge
- group: topics_partitions
  interval:
    minutes: 1
  dimensions:
  - key: redpanda_cluster
    value: const:your-redpanda-cluster
  - key: redpanda_namespace
    value: label:redpanda_namespace
  - key: redpanda_topic
    value: label:redpanda_topic
  - key: redpanda_partition
    value: label:redpanda_partition
  metrics:
  - key: redpanda.kafka.request.bytes.total
    value: metric:redpanda_kafka_request_bytes_total
    type: count
  - key: redpanda.kafka.replicas
    value: metric:redpanda_kafka_replicas
    type: gauge
  - key: redpanda.kafka.max_offset
    value: metric:redpanda_kafka_max_offset
    type: gauge
- group: rpc_connections
  interval:
    minutes: 1
  dimensions:
  - key: redpanda_cluster
    value: const:your-redpanda-cluster
  - key: redpanda_server
    value: label:redpanda_server
  metrics:
  - key: redpanda.rpc.active_connections
    value: metric:redpanda_rpc_active_connections
    type: gauge
metrics:
- key: redpanda.kafka.request.latency.seconds
  metadata:
    displayName: Kafka Request Latency
    description: Histogram of Kafka request latencies - provides p50, p95, p99 percentiles
    unit: Second
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.rpc.request.latency.seconds
  metadata:
    displayName: Internal RPC Request Latency
    description: Histogram of internal RPC request latencies between brokers - provides p50, p95, p99 percentiles
    unit: Second
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.rest_proxy.request.latency.seconds
  metadata:
    displayName: REST Proxy Request Latency
    description: Histogram of REST Proxy request latencies - provides p50, p95, p99 percentiles
    unit: Second
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.io.queue.read.ops.total
  metadata:
    displayName: I/O Read Operations
    description: Total read operations - indicates disk read load
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: false
      valueType: unknown
- key: redpanda.io.queue.write.ops.total
  metadata:
    displayName: I/O Write Operations
    description: Total write operations - indicates disk write load
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: false
      valueType: unknown
- key: redpanda.kafka.under_replicated_replicas
  metadata:
    displayName: Under-Replicated Replicas
    description: Partitions not fully replicated - DATA LOSS RISK
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.cluster.unavailable_partitions
  metadata:
    displayName: Unavailable Partitions
    description: Partitions without a leader - CANNOT SERVE REQUESTS
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.raft.leadership.changes
  metadata:
    displayName: Leadership Changes
    description: Raft leadership transfers - indicates cluster instability
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: false
      valueType: unknown
- key: redpanda.node.status.rpcs_timed_out
  metadata:
    displayName: Node RPC Timeouts
    description: Status RPC timeouts to peer nodes - connectivity issues
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.rpc.received.bytes
  metadata:
    displayName: Producer Throughput
    description: Total bytes received from producers
    unit: Byte
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.rpc.sent.bytes
  metadata:
    displayName: Consumer Throughput
    description: Total bytes sent to consumers
    unit: Byte
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.cpu.busy.seconds.total
  metadata:
    displayName: CPU Busy Time
    description: Total CPU non-idle time
    unit: Second
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: false
      valueType: unknown
- key: redpanda.uptime.seconds.total
  metadata:
    displayName: Uptime
    description: Total broker uptime
    unit: Second
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.memory.available.bytes
  metadata:
    displayName: Available Memory
    description: Available memory including reclaimable cache
    unit: Byte
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.memory.free.bytes
  metadata:
    displayName: Free Memory
    description: Free memory only
    unit: Byte
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.memory.allocated.bytes
  metadata:
    displayName: Allocated Memory
    description: Memory allocated by Redpanda
    unit: Byte
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: false
      valueType: unknown
- key: redpanda.storage.disk.free.bytes
  metadata:
    displayName: Disk Free Space
    description: Available disk space
    unit: Byte
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.storage.disk.total.bytes
  metadata:
    displayName: Disk Total Space
    description: Total disk space
    unit: Byte
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.storage.disk.free_space_alert
  metadata:
    displayName: Disk Space Alert
    description: Disk space critically low indicator
    unit: Count
    metricProperties:
      minValue: 0
      maxValue: 1
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.schema_registry.request.errors.total
  metadata:
    displayName: Schema Registry Errors
    description: Total Schema Registry request errors
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.rest_proxy.request.errors.total
  metadata:
    displayName: REST Proxy Errors
    description: Total REST Proxy request errors
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.kafka.consumer_group.lag.max
  metadata:
    displayName: Consumer Group Max Lag
    description: Maximum consumer lag across partitions
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.kafka.consumer_group.lag.sum
  metadata:
    displayName: Consumer Group Total Lag
    description: Total consumer lag across all partitions
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: true
      impactRelevant: true
      valueType: unknown
- key: redpanda.kafka.consumer_group.committed_offset
  metadata:
    displayName: Consumer Group Committed Offset
    description: Last committed offset for consumer group
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.kafka.request.bytes.total
  metadata:
    displayName: Topic Request Bytes
    description: Total request bytes by topic
    unit: Byte
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.rpc.active_connections
  metadata:
    displayName: Active RPC Connections
    description: Number of active RPC connections
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.cluster.brokers
  metadata:
    displayName: Cluster Brokers
    description: Number of configured brokers in the cluster
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: true
      valueType: unknown
- key: redpanda.cluster.partitions
  metadata:
    displayName: Cluster Partitions
    description: Total number of partitions in the cluster (replicas not included)
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.cluster.topics
  metadata:
    displayName: Cluster Topics
    description: Total number of topics in the cluster
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.kafka.replicas
  metadata:
    displayName: Topic Replicas
    description: Configured number of replicas for the topic
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.kafka.max_offset
  metadata:
    displayName: Partition Max Offset
    description: Latest readable offset of the partition (high watermark)
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.kafka.consumer_group.consumers
  metadata:
    displayName: Consumer Group - Number of Consumers
    description: Number of active consumers in the consumer group
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.kafka.consumer_group.topics
  metadata:
    displayName: Consumer Group - Number of Topics
    description: Number of topics consumed by the consumer group
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
- key: redpanda.application.build
  metadata:
    displayName: Application Build Information
    description: Redpanda build information (version and revision)
    unit: Count
    metricProperties:
      minValue: 0
      rootCauseRelevant: false
      impactRelevant: false
      valueType: unknown
